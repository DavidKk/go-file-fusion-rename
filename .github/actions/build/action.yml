name: "Build Go GUI App"
description: "Build Go GUI application for multiple platforms"

inputs:
  go-version:
    description: "Go version to use"
    required: false
    default: "1.24"

outputs:
  artifacts:
    description: "List of built artifacts"
    value: ${{ steps.artifacts.outputs.list }}

runs:
  using: "composite"
  steps:
    - name: Setup Go
      uses: actions/setup-go@v5
      with:
        go-version: ${{ inputs.go-version }}

    - name: Install GUI dependencies (Linux)
      if: runner.os == 'Linux'
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          libgtk-3-dev \
          libdbusmenu-glib-dev \
          libayatana-appindicator3-dev \
          libayatana-indicator3-dev

    - name: Build Linux Binary
      if: runner.os == 'Linux'
      shell: bash
      run: |
        export CGO_ENABLED=1
        go build -ldflags="-s -w" -o file-fusion-rename-linux main.go

    - name: Build Windows Binary
      if: runner.os == 'Windows'
      shell: cmd
      run: |
        set CGO_ENABLED=1
        go build -ldflags="-s -w" -o file-fusion-rename-windows.exe main.go

    - name: Build macOS Binary
      if: runner.os == 'macOS'
      shell: bash
      run: |
        export CGO_ENABLED=1
        go build -ldflags="-s -w" -o file-fusion-rename-macos main.go

    - name: Upload Linux Artifact
      if: runner.os == 'Linux'
      uses: actions/upload-artifact@v4
      with:
        name: file-fusion-rename-linux
        path: file-fusion-rename-linux

    - name: Upload Windows Artifact
      if: runner.os == 'Windows'
      uses: actions/upload-artifact@v4
      with:
        name: file-fusion-rename-windows
        path: file-fusion-rename-windows.exe

    - name: Upload macOS Artifact
      if: runner.os == 'macOS'
      uses: actions/upload-artifact@v4
      with:
        name: file-fusion-rename-macos
        path: file-fusion-rename-macos

    - name: Set artifacts output
      id: artifacts
      shell: bash
      run: |
        if [ "$RUNNER_OS" = "Linux" ]; then
          echo "list=file-fusion-rename-linux" >> $GITHUB_OUTPUT
        elif [ "$RUNNER_OS" = "Windows" ]; then
          echo "list=file-fusion-rename-windows.exe" >> $GITHUB_OUTPUT
        elif [ "$RUNNER_OS" = "macOS" ]; then
          echo "list=file-fusion-rename-macos" >> $GITHUB_OUTPUT
        fi
